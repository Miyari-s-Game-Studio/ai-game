# 互动叙事游戏引擎

本项目是一个灵活的、由 AI 驱动的引擎，用于创建和玩耍互动叙事游戏。它将基于 JSON 的规则集系统与生成式 AI 相结合，创造出动态的、由选择驱动的故事。玩家扮演一个角色，做出决定，并看到世界因他们的行为而改变，同时由 AI 游戏管理员将程序化的结果编织成引人入胜的叙事。

该引擎设计为高度可扩展，允许创作者通过简单的 JSON 配置文件创建自己独特的场景、行动和游戏机制。

**关于如何创建您自己的场景的详细指南，请参阅[规则集创作指南](docs/AUTHORING_GUIDE_zh.md)。**

## 主要功能

*   **规则驱动的场景**: 每个故事都在一个独立的 JSON 文件 (`/src/lib/rulesets/*.json`) 中定义，使得创建、修改和分享新的冒险变得容易。
*   **AI 驱动的叙事**: 游戏使用 Genkit 和一个大型语言模型 (LLM) 作为“游戏管理员”。AI 生成丰富的场景描述，并将游戏状态的变化转化为引人入胜的、实时的故事节奏。
*   **动态对话系统**: 与 AI 控制的 NPC 进行有目标的对话。引擎支持如揭开一个 `secret`（秘密）或说服一个角色达成 `agreement`（协议）等目标，并有专门的 AI 流程来管理对话。
*   **持久化的 AI 角色**: NPC 具有独特的个性，并被缓存在游戏状态中，确保玩家在整个场景中与同一个一致的角色互动。
*   **程序化迷你游戏**: 引擎包括用于技能检定 (`DiceRollDialog`) 和战斗 (`FightDialog`) 的内置系统，这些系统由玩家的行动触发，并通过玩家属性和几率的组合来解决。
*   **动态 UI**: 界面使用 React 和 ShadCN UI 构建，动态高亮叙事文本中的可互动元素，引导玩家的选择。
*   **可更换主题的界面**: 每个场景的外观和感觉都可以定制。引擎支持多种主题（例如，默认、像素、科幻、黑暗之魂），可以在规则文件中设置。

## 游戏流程

游戏在一个回合制的循环中进行，玩家采取一个行动，然后游戏引擎与 AI 合作，生成一个叙事结果。

1.  **场景生成**: 当玩家进入一个新的 `situation`（情境，一个地点或叙事节点）时，一个 AI 流程 (`generateSceneDescription`) 会生成一段丰富的、描述性的环境文本。这段文本巧妙地融入了可互动对象的关键词，让玩家知道他们可以与什么互动。

2.  **玩家行动**: 玩家从 `ActionPanel`（行动面板）中选择一个行动。行动可以很简单（例如，“观察”），也可以需要一个特定的目标（例如，“调查‘死鱼’”）。UI 会通过高亮叙事文本中的已知目标来帮助玩家。

3.  **游戏引擎处理**: 选择的行动被发送到 `processAction` 函数。引擎根据玩家的行动和目标，在当前情境的 `on_action` 数组中找到匹配的规则。然后它执行 `do` 或 `fail` 块，通过更新计数器、进度条或改变当前情境来修改 `GameState`（游戏状态）。这个过程会生成事实性的、程序化的日志（例如，“你获得了一个线索。”）。

4.  **叙事生成**: 引擎产生的程序化日志被发送到另一个 AI 流程 (`generateActionNarrative`)。这个 AI 扮演游戏管理员的角色，将事实性的结果转化为一个简短而引人入胜的故事节拍，描述玩家选择后刚刚发生的事情。

5.  **UI 更新**: UI 更新以反映新的 `GameState`，并向玩家显示来自 AI 的最新叙事，从而重新开始这个循环。
